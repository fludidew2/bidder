<div class="mx-auto max-w-7xl py-5 px-4 sm:px-6 lg:px-8">

<% if current_user.buyer? %>
 <div class="border-b border-gray-200 pb-5 sm:flex sm:items-center sm:justify-between">
  <h3 class="text-base font-semibold leading-6 text-gray-900">Your Requests</h3>
  <div class="mt-3 sm:ml-4 sm:mt-0">
      <%= link_to 'Create New Request', new_request_path, class: 'inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600' %>

  </div>
</div>


<% @requests.each do |request| %>
  <div class="rounded-lg mb-5 bg-white shadow">
  <div class="px-4 py-5  sm:p-6">
       <div class="mt-2 max-w-xl text-sm text-gray-500">
  <p><%= status_badge(request) %>  <%= link_to request.description, request_path(request) %></p>
  

      
              <p><%= request.bids.count %> Bids</p>
              </div>

      </div>
  </div>
 <% end %>


<% else %>
  <!-- Other content for different roles -->




    <% winning_requests = @requests.active_for_user(current_user).select { |req| req.bids.any? { |bid| bid.user == current_user && bid.status == 'winning' } } %>
  <% other_requests = @requests.active_for_user(current_user) - winning_requests %>
  
  <% winning_requests.each_with_index do |req, index| %>
    <div class="rounded-lg mb-5 bg-green-100 shadow">
      <div class="px-4 py-5 sm:p-6">
        <div class="bg-green-100 px-4 py-5 sm:px-6">
          <div class="flex space-x-3">
            <div class="flex-shrink-0">
              <img class="h-10 w-10 rounded-full" src="https://images.unsplash.com/photo-1550525811-e5869dd03032?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
            </div>
            <div class="min-w-0 flex-1">
              <p class="text-sm font-semibold text-gray-900">
                <a href="#" class="hover:underline">Chelsea Hagon</a>
              </p>
              <p class="text-sm text-gray-500">
                <a href="#" class="hover:underline">December 9 at 11:43 AM</a>
              </p>
            </div>
            <div class="flex flex-shrink-0 self-center">
              <div class="relative inline-block text-left">
                <div>
                  <button type="button" class="-m-2 flex items-center rounded-full p-2 text-gray-400 hover:text-gray-600" id="menu-0-button" aria-expanded="false" aria-haspopup="true">
                    <span class="sr-only">Open options</span>
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                      <path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <p class="text-gray-600"><%= req.description %></p>
      </div>
    </div>
  <% end %>
  
  <% other_requests.each_with_index do |req, index| %>
    <div class="rounded-lg mb-5 bg-white shadow">
      <div class="px-4 py-5 sm:p-6">
        <div class="bg-white px-4 py-5 sm:px-6">
          <div class="flex space-x-3">
            <div class="flex-shrink-0">
              <img class="h-10 w-10 rounded-full" src="https://images.unsplash.com/photo-1550525811-e5869dd03032?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
            </div>
            <div class="min-w-0 flex-1">
              <p class="text-sm font-semibold text-gray-900">
                <a href="#" class="hover:underline">Chelsea Hagon</a>
              </p>
              <p class="text-sm text-gray-500">
                <a href="#" class="hover:underline">December 9 at 11:43 AM</a>
              </p>
            </div>
            <div class="flex flex-shrink-0 self-center">
              <div class="relative inline-block text-left">
                <div>
                  <button type="button" class="-m-2 flex items-center rounded-full p-2 text-gray-400 hover:text-gray-600" id="menu-0-button" aria-expanded="false" aria-haspopup="true">
                    <span class="sr-only">Open options</span>
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                      <path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <p class="text-gray-600"><%= req.description %></p>
        <div class="flex p-8 space-x-3">
          <!-- Bid Button -->
          <div data-controller="bid-modal">
            <button type="button" data-action="click->bid-modal#open" data-bid-modal-index="<%= index %>" class="inline-flex items-center px-3 py-1.5 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Bid
            </button>
            <!-- Modal -->
            <div data-bid-modal-target="modal" data-bid-modal-index="<%= index %>" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-75 hidden">
              <div class="bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                      <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                        Enter Bid Amount
                      </h3>
                      <p>You are entering a bid for: <%= req.description %></p>
                      <div class="mt-2">
                        <form data-bid-modal-target="form" data-action="submit->bid-modal#submitForm">
                          <input type="hidden" name="request_id" value="<%= req.id %>">
                          <div>
                            <label for="bid_amount" class="block text-sm font-medium text-gray-700">Bid Amount</label>
                            <input type="number" name="amount" id="amount" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" required>
                          </div>
                          <div class="mt-4">
                            <button type="submit" class="inline-flex justify-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                              Submit Bid
                            </button>
                            <button type="button" data-action="click->bid-modal#close" class="inline-flex justify-center px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                              Cancel
                            </button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <%= button_to 'Decline', request_path(req), method: :delete, data: { confirm: 'Are you sure you want to decline this request?' }, class: 'inline-flex items-center px-3 py-1.5 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500' %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
